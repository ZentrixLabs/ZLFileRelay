<Window x:Class="ZLFileRelay.ConfigTool.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:ZLFileRelay.ConfigTool"
        xmlns:ui="http://schemas.modernwpf.com/2019"
        xmlns:converters="clr-namespace:ZLFileRelay.ConfigTool.Converters"
        ui:WindowHelper.UseModernWindowStyle="True"
        mc:Ignorable="d"
        Title="ZL File Relay - Configuration Tool" 
        Height="750" 
        Width="1100"
        MinHeight="600"
        MinWidth="900"
        WindowStartupLocation="CenterScreen">
    <Window.Resources>
        <converters:BoolToAllowedDeniedConverter x:Key="BoolToAllowedDeniedConverter"/>
        <converters:BoolToEnabledDisabledConverter x:Key="BoolToEnabledDisabledConverter"/>
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Main Content with TabControl -->
        <TabControl Grid.Row="0" Margin="10">
            
            <!-- Dashboard Tab -->
            <TabItem Header="Dashboard">
                <ContentControl x:Name="DashboardContent"/>
            </TabItem>
            
            <!-- Service Management Tab -->
            <TabItem Header="Service Management">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="20">
                        
                        <!-- Service Status -->
                        <ui:SimpleStackPanel Spacing="10" Margin="0,0,0,20">
                            <TextBlock Text="Service Status" 
                                       Style="{StaticResource TitleTextBlockStyle}"/>
                            <Border Background="{DynamicResource SystemControlBackgroundAccentBrush}" 
                                    CornerRadius="4" 
                                    Padding="15">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    
                                    <TextBlock Grid.Column="0" Text="Status:" Foreground="White" 
                                               VerticalAlignment="Center" FontWeight="Bold"/>
                                    <TextBlock Grid.Column="1" x:Name="ServiceStatusText" 
                                               Text="Unknown" 
                                               Foreground="White"
                                               FontWeight="Bold" 
                                               FontSize="16"
                                               VerticalAlignment="Center" 
                                               Margin="10,0" />
                                    <Button Grid.Column="2" 
                                            x:Name="RefreshStatusButton" 
                                            Click="RefreshStatusButton_Click"
                                            Style="{StaticResource SecondaryButton}">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE72C;" FontSize="16" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                            <TextBlock Text="Refresh" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Button>
                                </Grid>
                            </Border>
                        </ui:SimpleStackPanel>

                        <!-- Service Controls -->
                        <ui:SimpleStackPanel Spacing="10" Margin="0,0,0,20">
                            <TextBlock Text="Service Controls" 
                                       Style="{StaticResource SubtitleTextBlockStyle}"/>
                            <WrapPanel>
                                <Button x:Name="InstallServiceButton" 
                                        Click="InstallServiceButton_Click" 
                                        Margin="0,0,10,10"
                                        Style="{StaticResource SecondaryButton}">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE896;" FontSize="16" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                        <TextBlock Text="Install Service" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Button>
                                <Button x:Name="UninstallServiceButton" 
                                        Click="UninstallServiceButton_Click" 
                                        Margin="0,0,10,10"
                                        Style="{StaticResource DestructiveButton}">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE74D;" FontSize="16" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                        <TextBlock Text="Uninstall Service" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Button>
                                <Button x:Name="StartServiceButton" 
                                        Click="StartServiceButton_Click" 
                                        Style="{StaticResource PrimaryButton}"
                                        Margin="0,0,10,10">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE768;" FontSize="16" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                        <TextBlock Text="Start Service" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Button>
                                <Button x:Name="StopServiceButton" 
                                        Click="StopServiceButton_Click" 
                                        Margin="0,0,10,10"
                                        Style="{StaticResource SecondaryButton}">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE71A;" FontSize="16" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                        <TextBlock Text="Stop Service" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Button>
                            </WrapPanel>
                        </ui:SimpleStackPanel>

                        <!-- Credentials Status -->
                        <ui:SimpleStackPanel Spacing="10" Margin="0,0,0,20">
                            <TextBlock Text="SMB Credentials" 
                                       Style="{StaticResource SubtitleTextBlockStyle}"/>
                            <Border BorderBrush="{DynamicResource SystemControlForegroundBaseMediumBrush}" 
                                    BorderThickness="1" 
                                    CornerRadius="4" 
                                    Padding="15">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    
                                    <TextBlock Grid.Column="0" Text="Credentials:" VerticalAlignment="Center"/>
                                    <TextBlock Grid.Column="1" 
                                               x:Name="CredentialsStatusText" 
                                               Text="Not Configured" 
                                               FontWeight="Bold" 
                                               VerticalAlignment="Center" 
                                               Margin="10,0" />
                                    <Button Grid.Column="2" 
                                            x:Name="ConfigureCredentialsButton" 
                                            Click="ConfigureCredentialsButton_Click" 
                                            Style="{StaticResource PrimaryButton}">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE8D7;" FontSize="16" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                            <TextBlock Text="Configure SMB" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Button>
                                </Grid>
                            </Border>
                        </ui:SimpleStackPanel>

                        <!-- Log Output -->
                        <ui:SimpleStackPanel Spacing="10">
                            <TextBlock Text="Activity Log" 
                                       Style="{StaticResource SubtitleTextBlockStyle}"/>
                            <Border BorderBrush="{DynamicResource SystemControlForegroundBaseMediumBrush}" 
                                    BorderThickness="1" 
                                    CornerRadius="4">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="200" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>
                                    
                                    <ScrollViewer Grid.Row="0" 
                                                  VerticalScrollBarVisibility="Auto" 
                                                  HorizontalScrollBarVisibility="Auto"
                                                  Padding="10">
                                        <ItemsControl x:Name="LogOutputItems">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding}" 
                                                               FontFamily="Consolas" 
                                                               FontSize="12"
                                                               TextWrapping="Wrap" />
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </ScrollViewer>
                                    
                                    <Button Grid.Row="1" 
                                            x:Name="ClearLogButton" 
                                            Content="Clear Log" 
                                            Click="ClearLogButton_Click" 
                                            HorizontalAlignment="Right" 
                                            Margin="10" />
                                </Grid>
                            </Border>
                        </ui:SimpleStackPanel>

                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Configuration Tab -->
            <TabItem Header="Configuration Settings">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="20">
                        <TextBlock Text="File Transfer Configuration" 
                                   Style="{StaticResource TitleTextBlockStyle}"
                                   Margin="0,0,0,10"/>
                        
                        <!-- Contextual Help -->
                        <Expander Header="ℹ️ Configuration best practices" Margin="0,0,0,20" IsExpanded="False">
                            <Border Background="#FFF8F0" BorderBrush="#FFD700" BorderThickness="1" CornerRadius="4" Padding="15">
                                <StackPanel>
                                    <TextBlock TextWrapping="Wrap" FontWeight="SemiBold" Margin="0,0,0,10">
                                        Recommended Settings
                                    </TextBlock>
                                    <TextBlock TextWrapping="Wrap" Margin="0,0,0,5">
                                        <Bold>Watch Directory:</Bold> The folder where files are monitored for transfer. Place files here to transfer them.
                                    </TextBlock>
                                    <TextBlock TextWrapping="Wrap" Margin="0,0,0,5">
                                        <Bold>Archive Directory:</Bold> Successfully transferred files are moved here for record-keeping.
                                    </TextBlock>
                                    <TextBlock TextWrapping="Wrap" Margin="0,0,0,10">
                                        <Bold>Transfer Method:</Bold> Choose SSH for secure remote transfers or SMB for network shares.
                                    </TextBlock>
                                    <TextBlock TextWrapping="Wrap" Foreground="Gray" FontSize="11">
                                        💡 Tip: Enable "Archive after transfer" instead of "Delete after transfer" to maintain transfer history.
                                    </TextBlock>
                                </StackPanel>
                            </Border>
                        </Expander>
                        
                        <!-- Transfer Method -->
                        <ui:SimpleStackPanel Spacing="10" Margin="0,0,0,20">
                            <TextBlock Text="Transfer Method" Style="{StaticResource SubtitleTextBlockStyle}"/>
                            <RadioButton x:Name="SshRadio" Content="SSH/SCP" IsChecked="True" GroupName="TransferMethod"/>
                            <RadioButton x:Name="SmbRadio" Content="SMB/CIFS" GroupName="TransferMethod"/>
                        </ui:SimpleStackPanel>

                        <!-- Directories -->
                        <ui:SimpleStackPanel Spacing="10" Margin="0,0,0,20">
                            <TextBlock Text="Directories" Style="{StaticResource SubtitleTextBlockStyle}"/>
                            
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Watch Directory:" VerticalAlignment="Center" Margin="0,0,10,5"/>
                                <TextBox Grid.Row="0" Grid.Column="1" x:Name="WatchDirectoryTextBox" Margin="0,0,5,5"
                                         ToolTip="The directory where the service monitors for new files to transfer. Files placed here will be automatically transferred to the remote destination."/>
                                <Button Grid.Row="0" Grid.Column="2" Content="Browse..." Margin="0,0,0,5"/>
                                
                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Archive Directory:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                <TextBox Grid.Row="1" Grid.Column="1" x:Name="ArchiveDirectoryTextBox"
                                         ToolTip="Directory where files are moved after successful transfer (if archive option is enabled). Helps maintain transfer history."/>
                                <Button Grid.Row="1" Grid.Column="2" Content="Browse..."/>
                            </Grid>
                        </ui:SimpleStackPanel>

                        <!-- File Handling -->
                        <ui:SimpleStackPanel Spacing="10" Margin="0,0,0,20">
                            <TextBlock Text="File Handling" Style="{StaticResource SubtitleTextBlockStyle}"/>
                            <CheckBox x:Name="ArchiveAfterTransferCheckBox" Content="Archive files after successful transfer"/>
                            <CheckBox x:Name="DeleteAfterTransferCheckBox" Content="Delete files after successful transfer (not recommended)"/>
                            <CheckBox x:Name="VerifyTransferCheckBox" Content="Verify file integrity after transfer" IsChecked="True"/>
                        </ui:SimpleStackPanel>

                        <!-- Save Button -->
                        <Button x:Name="SaveConfigButton"
                                Style="{StaticResource PrimaryButton}"
                                Padding="20,10"
                                Height="38"
                                HorizontalAlignment="Left">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE74E;" FontSize="16" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                <TextBlock Text="Save Configuration" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        
                        <TextBlock x:Name="ConfigStatusText" 
                                   Margin="0,10,0,0" 
                                   Foreground="Green"/>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Web Portal Settings Tab -->
            <TabItem Header="Web Portal">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="20">
                        <TextBlock Text="Web Portal Settings" 
                                   Style="{StaticResource TitleTextBlockStyle}"
                                   Margin="0,0,0,20"/>
                        
                        <!-- Server Configuration -->
                        <ui:SimpleStackPanel Spacing="10" Margin="0,0,0,20">
                            <TextBlock Text="Server Configuration" Style="{StaticResource SubtitleTextBlockStyle}"/>
                            
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="10"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <TextBlock Grid.Row="0" Grid.Column="0" Text="HTTP Port:" VerticalAlignment="Center"/>
                                <ui:NumberBox Grid.Row="0" Grid.Column="1" x:Name="HttpPortBox" 
                                              Value="8080" Minimum="1" Maximum="65535" Margin="0,0,0,5"
                                              ToolTip="Port number for HTTP access to the web portal (default: 8080). Must not conflict with other services."/>
                                
                                <TextBlock Grid.Row="1" Grid.Column="0" Text="HTTPS Port:" VerticalAlignment="Center"/>
                                <ui:NumberBox Grid.Row="1" Grid.Column="1" x:Name="HttpsPortBox" 
                                              Value="8443" Minimum="1" Maximum="65535"
                                              ToolTip="Port number for secure HTTPS access (default: 8443). Requires valid SSL certificate."/>
                                
                                <CheckBox Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="2" 
                                          x:Name="EnableHttpsCheckBox" Content="Enable HTTPS"/>
                            </Grid>
                        </ui:SimpleStackPanel>

                        <!-- SSL Certificate -->
                        <ui:SimpleStackPanel Spacing="10" Margin="0,0,0,20">
                            <TextBlock Text="SSL Certificate (Required for HTTPS)" Style="{StaticResource SubtitleTextBlockStyle}"/>
                            
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="10"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Certificate Path:" VerticalAlignment="Center"/>
                                <TextBox Grid.Row="0" Grid.Column="1" x:Name="CertPathTextBox" Margin="0,0,5,5"
                                         ToolTip="Full path to the SSL certificate file (.pfx or .p12 format). Required for HTTPS. Example: C:\Certificates\mysite.pfx"/>
                                <Button Grid.Row="0" Grid.Column="2" Content="Browse..." x:Name="BrowseCertButton" Margin="0,0,0,5"/>
                                
                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Password:" VerticalAlignment="Center"/>
                                <PasswordBox Grid.Row="1" Grid.Column="1" x:Name="CertPasswordBox"/>
                                <Button Grid.Row="1" Grid.Column="2" Content="Test Cert" x:Name="TestCertButton"/>
                                
                                <TextBlock Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="3" 
                                           x:Name="CertStatusText" Foreground="Gray"/>
                            </Grid>
                        </ui:SimpleStackPanel>

                        <!-- Actions -->
                        <WrapPanel Margin="0,10,0,0">
                            <Button x:Name="SaveWebConfigButton"
                                    Style="{StaticResource PrimaryButton}"
                                    Padding="20,10"
                                    Height="38"
                                    Margin="0,0,10,0">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE74E;" FontSize="16" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                    <TextBlock Text="Save Configuration" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>
                            <Button x:Name="RestartWebServiceButton"
                                    Style="{StaticResource SecondaryButton}"
                                    Padding="20,10"
                                    Height="38">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE72C;" FontSize="16" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                    <TextBlock Text="Restart Web Service" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>
                        </WrapPanel>
                        
                        <TextBlock x:Name="WebPortalStatusText" 
                                   Margin="0,10,0,0" 
                                   TextWrapping="Wrap"/>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- SSH Settings Tab (second Web Portal is actually SSH) -->
            <TabItem Header="SSH / Transfer">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="20">
                        <TextBlock Text="SSH/SCP Configuration" 
                                   Style="{StaticResource TitleTextBlockStyle}"
                                   Margin="0,0,0,10"/>
                        
                        <!-- Contextual Help -->
                        <Expander Header="ℹ️ How do I set up SSH?" Margin="0,0,0,20" IsExpanded="False">
                            <Border Background="#F0F8FF" BorderBrush="#B0C4DE" BorderThickness="1" CornerRadius="4" Padding="15">
                                <StackPanel>
                                    <TextBlock TextWrapping="Wrap" FontWeight="SemiBold" Margin="0,0,0,10">
                                        Quick Start Guide: SSH Key Authentication
                                    </TextBlock>
                                    <TextBlock TextWrapping="Wrap" Margin="0,0,0,5">
                                        <Bold>Step 1:</Bold> Click "Generate Key Pair" below to create a new SSH key pair.
                                    </TextBlock>
                                    <TextBlock TextWrapping="Wrap" Margin="0,0,0,5">
                                        <Bold>Step 2:</Bold> Copy the public key that appears in the log.
                                    </TextBlock>
                                    <TextBlock TextWrapping="Wrap" Margin="0,0,0,5">
                                        <Bold>Step 3:</Bold> Add the public key to your remote server's ~/.ssh/authorized_keys file.
                                    </TextBlock>
                                    <TextBlock TextWrapping="Wrap" Margin="0,0,0,5">
                                        <Bold>Step 4:</Bold> Enter your SSH host, port, username, and destination path below.
                                    </TextBlock>
                                    <TextBlock TextWrapping="Wrap" Margin="0,0,0,10">
                                        <Bold>Step 5:</Bold> Click "Test SSH Connection" to verify everything works.
                                    </TextBlock>
                                    <TextBlock TextWrapping="Wrap" Foreground="Gray" FontSize="11">
                                        💡 Tip: ED25519 keys provide strong security and are recommended for SSH authentication.
                                    </TextBlock>
                                </StackPanel>
                            </Border>
                        </Expander>
                        
                        <!-- Connection Settings -->
                        <ui:SimpleStackPanel Spacing="10" Margin="0,0,0,20">
                            <TextBlock Text="Connection Settings" Style="{StaticResource SubtitleTextBlockStyle}"/>
                            
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Host:" VerticalAlignment="Center"/>
                                <TextBox Grid.Row="0" Grid.Column="1" x:Name="SshHostTextBox" Margin="0,0,0,5"
                                         ToolTip="Hostname or IP address of the remote SSH server. Examples: 192.168.1.100, server.domain.com"/>
                                
                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Port:" VerticalAlignment="Center"/>
                                <ui:NumberBox Grid.Row="1" Grid.Column="1" x:Name="SshPortBox" 
                                              Value="22" Minimum="1" Maximum="65535" Margin="0,0,0,5"/>
                                
                                <TextBlock Grid.Row="2" Grid.Column="0" Text="Username:" VerticalAlignment="Center"/>
                                <TextBox Grid.Row="2" Grid.Column="1" x:Name="SshUsernameTextBox" Margin="0,0,0,5"
                                         ToolTip="Username for SSH authentication on the remote server. This user must have the public key in their authorized_keys file."/>
                                
                                <TextBlock Grid.Row="3" Grid.Column="0" Text="Destination Path:" VerticalAlignment="Center"/>
                                <TextBox Grid.Row="3" Grid.Column="1" x:Name="SshDestPathTextBox" 
                                         Text="/data/incoming"
                                         ToolTip="Full path on the remote server where files will be transferred. Must exist and be writable by the SSH user. Example: /data/incoming"/>
                            </Grid>
                        </ui:SimpleStackPanel>

                        <!-- SSH Key Management -->
                        <ui:SimpleStackPanel Spacing="10" Margin="0,0,0,20">
                            <TextBlock Text="SSH Key Authentication" Style="{StaticResource SubtitleTextBlockStyle}"/>
                            
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="10"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Private Key Path:" VerticalAlignment="Center"/>
                                <TextBox Grid.Row="0" Grid.Column="1" x:Name="SshKeyPathTextBox" Margin="0,0,5,0"
                                         ToolTip="Path to the SSH private key file for authentication. The corresponding public key must be added to the remote server's authorized_keys file."/>
                                <Button Grid.Row="0" Grid.Column="2" Content="Browse..." x:Name="BrowseKeyButton"/>
                                
                                <StackPanel Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="3" Orientation="Horizontal">
                                    <Button x:Name="GenerateKeyButton"
                                            Style="{StaticResource PrimaryButton}"
                                            Padding="15,8"
                                            Margin="0,0,10,0">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE192;" FontSize="16" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                            <TextBlock Text="Generate Key Pair" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Button>
                                    <Button x:Name="ViewPublicKeyButton"
                                            Style="{StaticResource SecondaryButton}"
                                            Padding="15,8"
                                            Margin="0,0,10,0">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE890;" FontSize="16" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                            <TextBlock Text="View Public Key" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Button>
                                    <Button x:Name="CopyPublicKeyButton"
                                            Style="{StaticResource SecondaryButton}"
                                            Padding="15,8">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE8C8;" FontSize="16" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                            <TextBlock Text="Copy to Clipboard" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Button>
                                </StackPanel>
                            </Grid>
                        </ui:SimpleStackPanel>

                        <!-- Connection Test -->
                        <ui:SimpleStackPanel Spacing="10" Margin="0,0,0,20">
                            <TextBlock Text="Connection Test" Style="{StaticResource SubtitleTextBlockStyle}"/>
                            <Button x:Name="TestSshButton"
                                    Style="{StaticResource SecondaryButton}"
                                    Padding="20,10"
                                    Height="38"
                                    HorizontalAlignment="Left">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xEA46;" FontSize="16" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                    <TextBlock Text="Test SSH Connection" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>
                            <Border BorderBrush="{DynamicResource SystemControlForegroundBaseMediumBrush}" 
                                    BorderThickness="1" 
                                    CornerRadius="4"
                                    Padding="10"
                                    MinHeight="100">
                                <TextBlock x:Name="SshTestResultText" 
                                           TextWrapping="Wrap"
                                           FontFamily="Consolas"
                                           Text="Click 'Test SSH Connection' to verify your settings"/>
                            </Border>
                        </ui:SimpleStackPanel>

                        <!-- Save Button -->
                        <Button x:Name="SaveSshConfigButton"
                                Style="{StaticResource PrimaryButton}"
                                Padding="20,10"
                                Height="38"
                                HorizontalAlignment="Left">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE74E;" FontSize="16" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                <TextBlock Text="Save SSH Configuration" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Service Account Tab -->
            <TabItem Header="Service Account">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="20">
                        <TextBlock Text="Service Account Management" 
                                   Style="{StaticResource TitleTextBlockStyle}"
                                   Margin="0,0,0,10"/>
                        
                        <!-- Contextual Help -->
                        <Expander Header="ℹ️ Why do I need a service account?" Margin="0,0,0,20" IsExpanded="False">
                            <Border Background="#F0FFF0" BorderBrush="#90EE90" BorderThickness="1" CornerRadius="4" Padding="15">
                                <StackPanel>
                                    <TextBlock TextWrapping="Wrap" FontWeight="SemiBold" Margin="0,0,0,10">
                                        About Service Accounts
                                    </TextBlock>
                                    <TextBlock TextWrapping="Wrap" Margin="0,0,0,10">
                                        Windows services run under a specific user account. The default "LocalSystem" account may not have access to network shares or specific folders.
                                    </TextBlock>
                                    <TextBlock TextWrapping="Wrap" FontWeight="SemiBold" Margin="0,0,0,5">
                                        When to change the service account:
                                    </TextBlock>
                                    <TextBlock TextWrapping="Wrap" Margin="15,0,0,5">
                                        • Need to access network shares (SMB/CIFS transfers)
                                    </TextBlock>
                                    <TextBlock TextWrapping="Wrap" Margin="15,0,0,5">
                                        • Need to access folders with specific permissions
                                    </TextBlock>
                                    <TextBlock TextWrapping="Wrap" Margin="15,0,0,10">
                                        • Require domain authentication
                                    </TextBlock>
                                    <TextBlock TextWrapping="Wrap" Foreground="DarkOrange" FontSize="11">
                                        ⚠️ Important: The service account needs "Log on as a service" rights and write permissions to all configured directories.
                                    </TextBlock>
                                </StackPanel>
                            </Border>
                        </Expander>
                        
                        <!-- Current Account Info -->
                        <ui:SimpleStackPanel Spacing="10" Margin="0,0,0,20">
                            <TextBlock Text="Current Service Account" Style="{StaticResource SubtitleTextBlockStyle}"/>
                            <Border Background="{DynamicResource SystemControlBackgroundAccentBrush}" 
                                    CornerRadius="4" 
                                    Padding="15">
                                <StackPanel>
                                    <TextBlock x:Name="CurrentAccountText" 
                                               Text="LocalSystem" 
                                               FontWeight="Bold"
                                               FontSize="16"
                                               Foreground="White"/>
                                    <TextBlock x:Name="AccountStatusText" 
                                               Text="✅ Profile exists | ✅ Has Logon as Service right" 
                                               Foreground="White"
                                               Margin="0,5,0,0"/>
                                </StackPanel>
                            </Border>
                        </ui:SimpleStackPanel>

                        <!-- Change Service Account -->
                        <ui:SimpleStackPanel Spacing="10" Margin="0,0,0,20">
                            <TextBlock Text="Change Service Account" Style="{StaticResource SubtitleTextBlockStyle}"/>
                            
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="10"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Domain:" VerticalAlignment="Center"/>
                                <TextBox Grid.Row="0" Grid.Column="1" x:Name="DomainTextBox" 
                                         Text="." Margin="0,0,0,5"
                                         ToolTip="Domain name for the service account. Use '.' for local machine accounts, or specify your Active Directory domain name."/>
                                
                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Username:" VerticalAlignment="Center"/>
                                <TextBox Grid.Row="1" Grid.Column="1" x:Name="ServiceAccountUsernameTextBox" 
                                         Margin="0,0,0,5"
                                         ToolTip="Username for the Windows service account. Format: DOMAIN\username or .\username for local accounts. This account needs 'Logon as Service' rights."/>
                                
                                <TextBlock Grid.Row="2" Grid.Column="0" Text="Password:" VerticalAlignment="Center"/>
                                <PasswordBox Grid.Row="2" Grid.Column="1" x:Name="ServiceAccountPasswordBox"/>
                                
                                <StackPanel Grid.Row="4" Grid.Column="0" Grid.ColumnSpan="2" Orientation="Horizontal">
                                    <Button x:Name="ApplyAccountButton"
                                            Style="{StaticResource PrimaryButton}"
                                            Padding="15,8"
                                            Margin="0,0,10,0">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE73E;" FontSize="16" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                            <TextBlock Text="Apply Account Change" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Button>
                                    <Button x:Name="GrantLogonRightsButton"
                                            Style="{StaticResource SecondaryButton}"
                                            Padding="15,8">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE785;" FontSize="16" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                            <TextBlock Text="Grant Logon Rights" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Button>
                                </StackPanel>
                            </Grid>
                        </ui:SimpleStackPanel>

                        <!-- Permission Management -->
                        <ui:SimpleStackPanel Spacing="10" Margin="0,0,0,20">
                            <TextBlock Text="Folder Permissions" Style="{StaticResource SubtitleTextBlockStyle}"/>
                            <TextBlock Text="Grant the service account permissions to all required folders:" 
                                       TextWrapping="Wrap"
                                       Foreground="Gray"
                                       Margin="0,0,0,10"/>
                            <WrapPanel>
                                <Button x:Name="FixUploadPermsButton"
                                        Style="{StaticResource SecondaryButton}"
                                        Padding="15,8"
                                        Margin="0,0,10,10">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE90F;" FontSize="16" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                        <TextBlock Text="Fix Upload Folder" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Button>
                                <Button x:Name="FixLogPermsButton"
                                        Style="{StaticResource SecondaryButton}"
                                        Padding="15,8"
                                        Margin="0,0,10,10">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE90F;" FontSize="16" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                        <TextBlock Text="Fix Log Folder" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Button>
                                <Button x:Name="FixAllPermsButton"
                                        Style="{StaticResource PrimaryButton}"
                                        Padding="15,8"
                                        Margin="0,0,10,10">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE90F;" FontSize="16" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                        <TextBlock Text="Fix All Folders" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Button>
                            </WrapPanel>
                        </ui:SimpleStackPanel>

                        <!-- Status Log -->
                        <ui:SimpleStackPanel Spacing="10">
                            <TextBlock Text="Operations Log" Style="{StaticResource SubtitleTextBlockStyle}"/>
                            <Border BorderBrush="{DynamicResource SystemControlForegroundBaseMediumBrush}" 
                                    BorderThickness="1" 
                                    CornerRadius="4"
                                    MinHeight="150">
                                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="10">
                                    <TextBlock x:Name="ServiceAccountLogText" 
                                               TextWrapping="Wrap"
                                               FontFamily="Consolas"
                                               FontSize="12"/>
                                </ScrollViewer>
                            </Border>
                        </ui:SimpleStackPanel>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Security Settings Tab -->
            <TabItem Header="Security">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="20">
                        <TextBlock Text="Security Configuration" 
                                   Style="{StaticResource TitleTextBlockStyle}"
                                   Margin="0,0,0,10"/>
                        <TextBlock Text="Configure file security policies and upload restrictions" 
                                   FontSize="14" 
                                   Foreground="Gray"
                                   Margin="0,0,0,20"/>
                        
                        <!-- Security Warning -->
                        <Border Background="#FFF3E0" BorderBrush="#FF9800" BorderThickness="2" CornerRadius="4" Padding="15" Margin="0,0,0,20">
                            <StackPanel>
                                <TextBlock FontWeight="SemiBold" Foreground="#E65100" Margin="0,0,0,10">
                                    ⚠️ Important Security Notice
                                </TextBlock>
                                <TextBlock TextWrapping="Wrap" Foreground="#424242" FontSize="12">
                                    These settings control what types of files can be uploaded and transferred. 
                                    Changes to these settings directly impact system security. For DMZ deployments, 
                                    keep executable files blocked unless specifically required for your use case.
                                </TextBlock>
                            </StackPanel>
                        </Border>

                        <!-- File Security Policies -->
                        <ui:SimpleStackPanel Spacing="15" Margin="0,0,0,30">
                            <TextBlock Text="File Security Policies" Style="{StaticResource SubtitleTextBlockStyle}"/>
                            
                            <!-- Allow Executable Files -->
                            <Border BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" 
                                    BorderThickness="1" 
                                    CornerRadius="4" 
                                    Padding="15">
                                <StackPanel>
                                    <CheckBox x:Name="AllowExecutableFilesCheckBox" 
                                              Content="Allow Executable Files"
                                              FontWeight="SemiBold"
                                              Margin="0,0,0,10"/>
                                    <TextBlock TextWrapping="Wrap" 
                                               FontSize="12" 
                                               Foreground="Gray"
                                               Margin="20,0,0,5">
                                        When enabled, allows uploading and transferring executable files (.exe, .dll, .bat, .cmd, .ps1, etc.)
                                    </TextBlock>
                                    <TextBlock TextWrapping="Wrap" 
                                               FontSize="11" 
                                               Foreground="#D32F2F"
                                               Margin="20,0,0,0">
                                        ⚠️ Security Risk: Only enable this if your workflow requires executable file transfers. 
                                        Executable files can pose security threats if from untrusted sources.
                                    </TextBlock>
                                </StackPanel>
                            </Border>

                            <!-- Allow Hidden Files -->
                            <Border BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" 
                                    BorderThickness="1" 
                                    CornerRadius="4" 
                                    Padding="15">
                                <StackPanel>
                                    <CheckBox x:Name="AllowHiddenFilesCheckBox" 
                                              Content="Allow Hidden Files"
                                              FontWeight="SemiBold"
                                              Margin="0,0,0,10"/>
                                    <TextBlock TextWrapping="Wrap" 
                                               FontSize="12" 
                                               Foreground="Gray"
                                               Margin="20,0,0,0">
                                        When enabled, allows processing of files with the hidden attribute set. 
                                        Hidden files are typically system files and usually should not be transferred.
                                    </TextBlock>
                                </StackPanel>
                            </Border>
                        </ui:SimpleStackPanel>

                        <!-- Upload Size Limits -->
                        <ui:SimpleStackPanel Spacing="15" Margin="0,0,0,30">
                            <TextBlock Text="Upload Size Limits" Style="{StaticResource SubtitleTextBlockStyle}"/>
                            
                            <Border BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" 
                                    BorderThickness="1" 
                                    CornerRadius="4" 
                                    Padding="15">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Row="0" Grid.Column="0" 
                                               Text="Maximum Upload Size:" 
                                               VerticalAlignment="Center" 
                                               Margin="0,0,15,0"
                                               FontWeight="SemiBold"/>
                                    
                                    <Slider Grid.Row="0" Grid.Column="1" 
                                            x:Name="MaxUploadSizeSlider"
                                            Minimum="1" 
                                            Maximum="100" 
                                            TickFrequency="1"
                                            IsSnapToTickEnabled="True"
                                            VerticalAlignment="Center"
                                            Margin="0,0,10,0"
                                            ToolTip="Set the maximum file size that can be uploaded (in GB)"/>
                                    
                                    <StackPanel Grid.Row="0" Grid.Column="2" 
                                                Orientation="Horizontal"
                                                VerticalAlignment="Center">
                                        <TextBlock x:Name="MaxUploadSizeValue" 
                                                   Text="{Binding ElementName=MaxUploadSizeSlider, Path=Value, StringFormat={}{0:F0}}"
                                                   FontSize="18" 
                                                   FontWeight="Bold"
                                                   VerticalAlignment="Center"/>
                                        <TextBlock Text=" GB" 
                                                   FontSize="14" 
                                                   Foreground="Gray"
                                                   VerticalAlignment="Center"
                                                   Margin="3,0,0,0"/>
                                    </StackPanel>

                                    <TextBlock Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="3"
                                               TextWrapping="Wrap" 
                                               FontSize="12" 
                                               Foreground="Gray"
                                               Margin="0,10,0,0">
                                        Maximum size for individual file uploads. Larger files will be rejected.
                                    </TextBlock>

                                    <Border Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="3"
                                            Background="#E3F2FD" 
                                            BorderBrush="#2196F3" 
                                            BorderThickness="1" 
                                            CornerRadius="4" 
                                            Padding="10"
                                            Margin="0,10,0,0">
                                        <StackPanel>
                                            <TextBlock TextWrapping="Wrap" FontSize="11" Foreground="#1565C0" FontWeight="SemiBold" Margin="0,0,0,5">
                                                💡 Recommended Settings by Environment
                                            </TextBlock>
                                            <TextBlock TextWrapping="Wrap" FontSize="11" Foreground="#424242" Margin="0,0,0,3">
                                                <Bold>DMZ/Production:</Bold> 1-5 GB (balanced security and functionality)
                                            </TextBlock>
                                            <TextBlock TextWrapping="Wrap" FontSize="11" Foreground="#424242" Margin="0,0,0,3">
                                                <Bold>Internal Network:</Bold> 5-20 GB (more permissive for trusted users)
                                            </TextBlock>
                                            <TextBlock TextWrapping="Wrap" FontSize="11" Foreground="#424242">
                                                <Bold>Development:</Bold> 20-100 GB (maximum flexibility for testing)
                                            </TextBlock>
                                        </StackPanel>
                                    </Border>

                                    <!-- Quick Size Presets -->
                                    <StackPanel Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="3"
                                                Orientation="Horizontal" 
                                                Margin="0,15,0,0">
                                        <TextBlock Text="Quick Presets:" 
                                                   VerticalAlignment="Center" 
                                                   Margin="0,0,10,0"
                                                   FontSize="12"
                                                   Foreground="Gray"/>
                                        <Button Content="1 GB" 
                                                Click="SetMaxSize1GB"
                                                Style="{StaticResource SecondaryButton}"
                                                Height="28" 
                                                Padding="10,0"
                                                Margin="0,0,5,0"/>
                                        <Button Content="5 GB" 
                                                Click="SetMaxSize5GB"
                                                Style="{StaticResource SecondaryButton}"
                                                Height="28" 
                                                Padding="10,0"
                                                Margin="0,0,5,0"/>
                                        <Button Content="10 GB" 
                                                Click="SetMaxSize10GB"
                                                Style="{StaticResource SecondaryButton}"
                                                Height="28" 
                                                Padding="10,0"
                                                Margin="0,0,5,0"/>
                                        <Button Content="20 GB" 
                                                Click="SetMaxSize20GB"
                                                Style="{StaticResource SecondaryButton}"
                                                Height="28" 
                                                Padding="10,0"
                                                Margin="0,0,5,0"/>
                                        <Button Content="50 GB" 
                                                Click="SetMaxSize50GB"
                                                Style="{StaticResource SecondaryButton}"
                                                Height="28" 
                                                Padding="10,0"/>
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </ui:SimpleStackPanel>

                        <!-- Audit Logging -->
                        <ui:SimpleStackPanel Spacing="15" Margin="0,0,0,30">
                            <TextBlock Text="Audit &amp; Compliance" Style="{StaticResource SubtitleTextBlockStyle}"/>
                            
                            <Border BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" 
                                    BorderThickness="1" 
                                    CornerRadius="4" 
                                    Padding="15">
                                <StackPanel>
                                    <CheckBox x:Name="EnableAuditLogCheckBox" 
                                              Content="Enable Audit Logging"
                                              FontWeight="SemiBold"
                                              Margin="0,0,0,10"
                                              IsChecked="True"/>
                                    <TextBlock TextWrapping="Wrap" 
                                               FontSize="12" 
                                               Foreground="Gray"
                                               Margin="20,0,0,15">
                                        Records all security-relevant events (uploads, transfers, authentication, authorization) to a separate audit log. 
                                        Recommended for compliance and security monitoring.
                                    </TextBlock>

                                    <Grid Margin="20,0,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Column="0" 
                                                   Text="Audit Log Path:" 
                                                   VerticalAlignment="Center" 
                                                   Margin="0,0,10,0"/>
                                        <TextBox Grid.Column="1" 
                                                 x:Name="AuditLogPathTextBox"
                                                 Text="C:\FileRelay\logs\audit.log"
                                                 Margin="0,0,5,0"
                                                 ToolTip="Full path to the audit log file"/>
                                        <Button Grid.Column="2" 
                                                Content="Browse..." 
                                                Style="{StaticResource SecondaryButton}"
                                                Height="32"/>
                                    </Grid>
                                </StackPanel>
                            </Border>
                        </ui:SimpleStackPanel>

                        <!-- Current Configuration Summary -->
                        <Border Background="#F5F5F5" 
                                BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" 
                                BorderThickness="1" 
                                CornerRadius="4" 
                                Padding="15"
                                Margin="0,0,0,20">
                            <StackPanel>
                                <TextBlock Text="Current Security Posture" 
                                           FontWeight="SemiBold" 
                                           Margin="0,0,0,10"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Executable Files:" FontSize="12" Margin="0,0,0,5"/>
                                    <TextBlock Grid.Row="0" Grid.Column="1" 
                                               Text="{Binding ElementName=AllowExecutableFilesCheckBox, Path=IsChecked, Converter={StaticResource BoolToAllowedDeniedConverter}}" 
                                               FontSize="12" 
                                               FontWeight="SemiBold"
                                               Margin="0,0,0,5"/>

                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Hidden Files:" FontSize="12" Margin="0,0,0,5"/>
                                    <TextBlock Grid.Row="1" Grid.Column="1" 
                                               Text="{Binding ElementName=AllowHiddenFilesCheckBox, Path=IsChecked, Converter={StaticResource BoolToAllowedDeniedConverter}}" 
                                               FontSize="12" 
                                               FontWeight="SemiBold"
                                               Margin="0,0,0,5"/>

                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Max File Size:" FontSize="12" Margin="0,0,0,5"/>
                                    <TextBlock Grid.Row="2" Grid.Column="1" FontSize="12" FontWeight="SemiBold" Margin="0,0,0,5">
                                        <Run Text="{Binding ElementName=MaxUploadSizeSlider, Path=Value, StringFormat={}{0:F0}}"/>
                                        <Run Text=" GB"/>
                                    </TextBlock>

                                    <TextBlock Grid.Row="3" Grid.Column="0" Text="Audit Logging:" FontSize="12"/>
                                    <TextBlock Grid.Row="3" Grid.Column="1" 
                                               Text="{Binding ElementName=EnableAuditLogCheckBox, Path=IsChecked, Converter={StaticResource BoolToEnabledDisabledConverter}}" 
                                               FontSize="12" 
                                               FontWeight="SemiBold"/>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- Save Button -->
                        <Button x:Name="SaveSecurityButton"
                                Click="SaveSecuritySettings"
                                Style="{StaticResource PrimaryButton}"
                                Padding="20,10"
                                Height="38"
                                HorizontalAlignment="Left">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE74E;" FontSize="16" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                <TextBlock Text="Save Security Settings" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>

                        <TextBlock x:Name="SecurityStatusText" 
                                   Margin="0,10,0,0" 
                                   Foreground="Green"/>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Remote Server / Advanced Tab -->
            <TabItem Header="Advanced">
                <ContentControl x:Name="RemoteServerContent"/>
            </TabItem>

            <!-- About Tab -->
            <TabItem Header="About">
                <ContentControl x:Name="AboutContent"/>
            </TabItem>

        </TabControl>

        <!-- Status Bar -->
        <Border Grid.Row="1" 
                Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
                BorderThickness="0,1,0,0"
                BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}">
            <Grid Height="32" Margin="10,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- Left: Connection Status -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock x:Name="ConnectionModeIcon" 
                               FontFamily="Segoe MDL2 Assets" 
                               Text="&#xE80F;" 
                               FontSize="16" 
                               VerticalAlignment="Center"
                               Margin="0,0,5,0"/>
                    <TextBlock x:Name="ConnectionModeText" 
                               Text="Local" 
                               VerticalAlignment="Center"
                               FontWeight="SemiBold"/>
                    <TextBlock Text="|" VerticalAlignment="Center" Margin="10,0" Foreground="Gray"/>
                    
                    <!-- Service Status -->
                    <TextBlock x:Name="StatusBarServiceIcon"
                               FontFamily="Segoe MDL2 Assets" 
                               Text="&#xF136;" 
                               FontSize="16" 
                               VerticalAlignment="Center"
                               Margin="0,0,5,0"/>
                    <TextBlock x:Name="StatusBarServiceText" 
                               Text="Service: Checking..." 
                               VerticalAlignment="Center"/>
                </StackPanel>
                
                <!-- Center: Messages -->
                <TextBlock Grid.Column="1" 
                           x:Name="StatusBarText" 
                           Text="Ready" 
                           VerticalAlignment="Center"
                           Margin="20,0"
                           TextTrimming="CharacterEllipsis"/>
                
                <!-- Right: Version -->
                <TextBlock Grid.Column="2" 
                           Text="v1.0.0" 
                           VerticalAlignment="Center"
                           Foreground="Gray"
                           FontSize="11"/>
            </Grid>
        </Border>
        
        <!-- Toast Notifications Overlay -->
        <ItemsControl x:Name="NotificationHost"
                      Grid.Row="0"
                      ItemsSource="{Binding Notifications}"
                      VerticalAlignment="Top"
                      HorizontalAlignment="Right"
                      Margin="20,60,20,0"
                      IsHitTestVisible="True">
            <ItemsControl.ItemTemplate>
                <DataTemplate>
                    <Border Background="{Binding BackgroundColor}"
                            CornerRadius="4"
                            Padding="15,10"
                            Margin="0,0,0,10"
                            MinWidth="300"
                            MaxWidth="400">
                        <Border.Effect>
                            <DropShadowEffect Color="Black" 
                                              Opacity="0.3" 
                                              BlurRadius="10" 
                                              ShadowDepth="2" 
                                              Direction="270"/>
                        </Border.Effect>
                        <Border.Style>
                            <Style TargetType="Border">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsClickable}" Value="True">
                                        <Setter Property="Cursor" Value="Hand"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Border.Style>
                        <Border.InputBindings>
                            <MouseBinding MouseAction="LeftClick" Command="{Binding ClickCommand}"/>
                        </Border.InputBindings>
                        
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <TextBlock Grid.Column="0"
                                       FontFamily="Segoe MDL2 Assets"
                                       Text="{Binding Icon}"
                                       FontSize="20"
                                       Foreground="White"
                                       VerticalAlignment="Center"
                                       Margin="0,0,10,0"/>
                            
                            <TextBlock Grid.Column="1"
                                       Text="{Binding Message}"
                                       Foreground="White"
                                       TextWrapping="Wrap"
                                       VerticalAlignment="Center"
                                       FontSize="14"/>
                            
                            <Button Grid.Column="2"
                                    x:Name="CloseNotificationButton"
                                    Content="×"
                                    FontSize="20"
                                    Foreground="White"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Width="24"
                                    Height="24"
                                    Padding="0"
                                    VerticalAlignment="Top"
                                    Cursor="Hand"
                                    Margin="10,0,0,0">
                                <Button.Style>
                                    <Style TargetType="Button">
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="Button">
                                                    <Border Background="{TemplateBinding Background}"
                                                            CornerRadius="12">
                                                        <ContentPresenter HorizontalAlignment="Center"
                                                                          VerticalAlignment="Center"/>
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter Property="Background" Value="#40FFFFFF"/>
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </Button.Style>
                            </Button>
                        </Grid>
                    </Border>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>
    </Grid>
</Window>
