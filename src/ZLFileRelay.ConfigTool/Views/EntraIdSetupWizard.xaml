<Window x:Class="ZLFileRelay.ConfigTool.Views.EntraIdSetupWizard"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Entra ID (Azure AD) Setup Wizard"
        Width="700"
        Height="650"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize">
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,20">
            <TextBlock Text="ðŸ“‹ Entra ID Setup Wizard" 
                       FontSize="24" 
                       FontWeight="Bold"
                       Foreground="#0066CC"
                       Margin="0,0,0,10"/>
            <TextBlock Text="Follow these steps to configure Entra ID authentication for ZL File Relay." 
                       TextWrapping="Wrap"
                       FontSize="12"
                       Foreground="Gray"/>
        </StackPanel>

        <!-- Instructions and Form -->
        <ScrollViewer Grid.Row="1" 
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled">
            <StackPanel>
                
                <!-- Step 1 -->
                <Border BorderBrush="#0066CC" 
                        BorderThickness="2" 
                        CornerRadius="5" 
                        Padding="15"
                        Background="#F0F7FF"
                        Margin="0,0,0,15">
                    <StackPanel>
                        <TextBlock Text="Step 1: Register Application in Azure Portal" 
                                   FontWeight="Bold" 
                                   FontSize="14"/>
                        <TextBlock TextWrapping="Wrap">
                            <Run Text="In the Azure Portal that opened, click "/>
                            <Run Text="New registration" FontWeight="Bold"/>
                            <Run Text=" and configure:"/>
                        </TextBlock>
                        <ListBox ItemsSource="{Binding RegistrationInfo}" 
                                 BorderThickness="0"
                                 Background="Transparent"
                                 IsHitTestVisible="False"
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding}" 
                                               TextWrapping="Wrap"
                                               Margin="0,2"
                                               Padding="5"/>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </StackPanel>
                </Border>

                <!-- Step 2 -->
                <Border BorderBrush="#0066CC" 
                        BorderThickness="2" 
                        CornerRadius="5" 
                        Padding="15"
                        Background="#F0F7FF"
                        Margin="0,0,0,15">
                    <StackPanel>
                        <TextBlock Text="Step 2: Create Client Secret" 
                                   FontWeight="Bold" 
                                   FontSize="14"/>
                        <TextBlock TextWrapping="Wrap">
                            <Run Text="In your new app registration:"/>
                            <LineBreak/>
                            <Run Text="1. Go to Certificates &amp; secrets"/>
                            <LineBreak/>
                            <Run Text="2. Click New client secret"/>
                            <LineBreak/>
                            <Run Text="3. Add description: "/>
                            <Run Text="ZL File Relay Secret" FontWeight="Bold"/>
                            <LineBreak/>
                            <Run Text="4. Select expiration (recommend 24 months)"/>
                            <LineBreak/>
                            <Run Text="5. Click Add and IMMEDIATELY copy the Value"/>
                        </TextBlock>
                    </StackPanel>
                </Border>

                <!-- Step 3 -->
                <Border BorderBrush="#0066CC" 
                        BorderThickness="2" 
                        CornerRadius="5" 
                        Padding="15"
                        Background="#F0F7FF"
                        Margin="0,0,0,15">
                    <StackPanel>
                        <TextBlock Text="Step 3: Note Your Credentials" 
                                   FontWeight="Bold" 
                                   FontSize="14"/>
                        <TextBlock TextWrapping="Wrap">
                            From the app registration Overview page, copy the following values:
                        </TextBlock>
                    </StackPanel>
                </Border>

                <!-- Credential Form -->
                <Border BorderBrush="#0066CC" 
                        BorderThickness="2" 
                        CornerRadius="5" 
                        Padding="15"
                        Background="White"
                        Margin="0,0,0,15">
                    <StackPanel>
                        <TextBlock Text="Enter Your Credentials" 
                                   FontWeight="Bold" 
                                   FontSize="14"/>
                        
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="120"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Tenant ID:" VerticalAlignment="Center"/>
                            <TextBox Grid.Row="0" Grid.Column="1" 
                                     x:Name="TenantIdBox"
                                     Margin="5,0,5,0"
                                     ToolTip="Directory (tenant) ID from Overview page (GUID)"/>
                            <Button Grid.Row="0" Grid.Column="2" 
                                    Content="ðŸ’¾ Copy"
                                    Click="CopyFromClipboard_TenantId"
                                    Width="60"
                                    Height="25"/>

                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Client ID:" VerticalAlignment="Center"/>
                            <TextBox Grid.Row="1" Grid.Column="1" 
                                     x:Name="ClientIdBox"
                                     Margin="5,5,5,0"
                                     ToolTip="Application (client) ID from Overview page (GUID)"/>
                            <Button Grid.Row="1" Grid.Column="2" 
                                    Content="ðŸ’¾ Copy"
                                    Click="CopyFromClipboard_ClientId"
                                    Width="60"
                                    Height="25"/>

                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Client Secret:" VerticalAlignment="Center"/>
                            <PasswordBox Grid.Row="2" Grid.Column="1" 
                                         x:Name="ClientSecretBox"
                                         Margin="5,5,5,0"
                                         ToolTip="Value from the client secret you just created"/>
                            <Button Grid.Row="2" Grid.Column="2" 
                                    Content="ðŸ’¾ Copy"
                                    Click="CopyFromClipboard_ClientSecret"
                                    Width="60"
                                    Height="25"/>

                            <TextBlock Grid.Row="3" Grid.Column="0" Text="Redirect URIs:" VerticalAlignment="Top" Margin="0,5,5,0"/>
                            <StackPanel Grid.Row="3" Grid.Column="1" Margin="5,5,5,0">
                                <TextBlock Text="Auto-detected hostnames:" 
                                           FontSize="10" 
                                           Foreground="Gray" 
                                           Margin="0,0,0,3"/>
                                <ListBox ItemsSource="{Binding RedirectUris, Mode=OneWay}"
                                         Height="60"
                                         BorderThickness="1"
                                         BorderBrush="#CCCCCC"
                                         Background="#F5F5F5"
                                         IsHitTestVisible="False"
                                         ScrollViewer.HorizontalScrollBarVisibility="Auto"
                                         ToolTip="Automatically detected hostname variations">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding}" Margin="2" FontFamily="Consolas" FontSize="10"/>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>
                                <TextBlock Text="Add additional custom hostnames (one per line):" 
                                           FontSize="10" 
                                           Foreground="Gray" 
                                           Margin="0,10,0,3"/>
                                <TextBox x:Name="AdditionalUrisBox"
                                         Height="60"
                                         AcceptsReturn="True"
                                         TextWrapping="Wrap"
                                         VerticalScrollBarVisibility="Auto"
                                         FontFamily="Consolas"
                                         FontSize="10"
                                         TextChanged="AdditionalUrisBox_TextChanged"
                                         ToolTip="Enter additional hostnames not automatically detected (e.g., dfwupload.root.mpmaterials.com)"/>
                            </StackPanel>
                        </Grid>

                        <Border BorderBrush="Green" 
                                BorderThickness="1" 
                                CornerRadius="5" 
                                Padding="10"
                                Background="#F0FFF0"
                                Margin="0,10,0,0">
                            <StackPanel>
                                <TextBlock Text="ðŸ“‹ Complete Redirect URI List (copy all):" 
                                           FontWeight="Bold"
                                           Margin="0,0,0,5"/>
                                <TextBox x:Name="CompleteUriList"
                                         Height="80"
                                         AcceptsReturn="True"
                                         TextWrapping="Wrap"
                                         IsReadOnly="True"
                                         Background="White"
                                         FontFamily="Consolas"
                                         FontSize="10"
                                         ToolTip="All redirect URIs to add to Azure Portal - copy this entire list"/>
                                <Button Content="ðŸ“‹ Copy Complete List to Clipboard"
                                        Click="CopyCompleteList_Click"
                                        Margin="0,5,0,0"
                                        ToolTip="Copy all URIs to clipboard for easy pasting into Azure Portal"/>
                            </StackPanel>
                        </Border>

                        <Border BorderBrush="Orange" 
                                BorderThickness="1" 
                                CornerRadius="5" 
                                Padding="10"
                                Background="#FFF8E1"
                                Margin="0,10,0,0">
                            <StackPanel>
                                <TextBlock Text="âš ï¸ Important Configuration in Azure Portal:" 
                                           FontWeight="Bold"
                                           Margin="0,0,0,5"/>
                                <TextBlock TextWrapping="Wrap">
                                    <Run Text="1. Go to your app registration > Authentication"/>
                                    <LineBreak/>
                                    <Run Text="2. Click Add a platform > Web"/>
                                    <LineBreak/>
                                    <Run Text="3. Add ALL Redirect URIs from list above (one at a time, or paste the complete list)"/>
                                    <LineBreak/>
                                    <Run Text="4. Click Configure after each URI"/>
                                </TextBlock>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Border>

                <!-- Help Section -->
                <Border BorderBrush="#CCCCCC" 
                        BorderThickness="1" 
                        CornerRadius="5" 
                        Padding="10"
                        Background="#FAFAFA">
                    <StackPanel>
                        <TextBlock Text="ðŸ“š Need Help?" 
                                   FontWeight="Bold"
                                   Margin="0,0,0,5"/>
                        <TextBlock TextWrapping="Wrap">
                            <Run Text="See detailed documentation:"/>
                            <Hyperlink NavigateUri="file:///C:/Program Files/ZLFileRelay/docs/deployment/ENTRA_ID_SETUP.md"
                                       RequestNavigate="Hyperlink_RequestNavigate">
                                ENTRA_ID_SETUP.md
                            </Hyperlink>
                        </TextBlock>
                    </StackPanel>
                </Border>

            </StackPanel>
        </ScrollViewer>

        <!-- Buttons -->
        <StackPanel Grid.Row="2" 
                    Orientation="Horizontal" 
                    HorizontalAlignment="Right" 
                    Margin="0,20,0,0">
            <Button Content="Cancel" 
                    Click="Cancel_Click"
                    Width="100"
                    Height="35"
                    Margin="0,0,10,0"/>
            <Button Content="âœ… Finish Setup" 
                    Click="Finish_Click"
                    Width="150"
                    Height="35"
                    FontWeight="Bold"
                    Background="#0066CC"
                    Foreground="White"/>
        </StackPanel>
    </Grid>
</Window>

