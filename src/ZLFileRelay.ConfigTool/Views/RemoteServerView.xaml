<UserControl x:Class="ZLFileRelay.ConfigTool.Views.RemoteServerView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:converters="clr-namespace:ZLFileRelay.ConfigTool.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="800">
    <UserControl.Resources>
        <converters:InverseBoolConverter x:Key="InverseBoolConverter"/>
        <converters:StringToVisibilityConverter x:Key="StringToVisibilityConverter"/>
    </UserControl.Resources>
    
    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="20">
            <!-- Header -->
            <TextBlock Text="Remote Server Connection" FontSize="24" FontWeight="Bold" Margin="0,0,0,20"/>
            <TextBlock TextWrapping="Wrap" Margin="0,0,0,20" Foreground="Gray">
                Configure the ConfigTool to manage a local or remote ZL File Relay installation. 
                Remote management is useful for Windows Server Core deployments where GUI applications cannot run.
            </TextBlock>

            <!-- Connection Mode -->
            <GroupBox Header="Connection Mode" Padding="15" Margin="0,0,0,15">
                <StackPanel>
                    <RadioButton Content="Local Machine" IsChecked="{Binding IsLocalMode}" 
                                 GroupName="ConnectionMode" Margin="0,5"/>
                    <TextBlock Text="Manage ZL File Relay on this computer" 
                               Margin="25,0,0,10" Foreground="Gray" FontSize="11"/>
                    
                    <RadioButton Content="Remote Server" IsChecked="{Binding IsRemoteMode}" 
                                 GroupName="ConnectionMode" Margin="0,10,0,5"/>
                    <TextBlock Text="Manage ZL File Relay on a remote Windows Server (including Server Core)" 
                               Margin="25,0,0,5" Foreground="Gray" FontSize="11"/>
                </StackPanel>
            </GroupBox>

            <!-- Remote Server Settings -->
            <GroupBox Header="Remote Server Settings" Padding="15" Margin="0,0,0,15"
                      IsEnabled="{Binding IsRemoteMode}">
                <StackPanel>
                    <TextBlock Text="Server Name or IP Address:" Margin="0,0,0,5"/>
                    <TextBox Text="{Binding ServerName, UpdateSourceTrigger=PropertyChanged}" 
                             Height="30" Margin="0,0,0,15"/>
                    <TextBlock Text="Examples: SERVER01, 192.168.1.100, server.domain.com" 
                               Margin="0,-10,0,15" Foreground="Gray" FontSize="11"/>

                    <!-- Credentials for Remote Management -->
                    <CheckBox Content="Use current Windows credentials" 
                              IsChecked="{Binding UseCurrentCredentials}" 
                              Margin="0,5"/>
                    <TextBlock TextWrapping="Wrap" Margin="0,5,0,10" Foreground="Gray" FontSize="11">
                        Use your current Windows credentials for remote management. 
                        Note: These are NOT the service account credentials - those are configured separately.
                    </TextBlock>
                    
                    <!-- Alternate Admin Credentials (optional) -->
                    <StackPanel IsEnabled="{Binding UseCurrentCredentials, Converter={StaticResource InverseBoolConverter}}">
                        <TextBlock Text="Alternate Admin Credentials:" Margin="0,5,0,5" FontWeight="SemiBold"/>
                        <TextBlock TextWrapping="Wrap" Margin="0,0,0,5" Foreground="Gray" FontSize="11">
                            Provide administrator credentials if different from your current login.
                            Do NOT enter service account credentials here.
                        </TextBlock>
                        <TextBlock Text="Username:" Margin="0,5,0,2"/>
                        <TextBox Text="{Binding Username, UpdateSourceTrigger=PropertyChanged}" 
                                 Height="28" Margin="0,0,0,5"/>
                        <TextBlock Text="Password:" Margin="0,5,0,2"/>
                        <PasswordBox x:Name="AdminPasswordBox" Height="28" Margin="0,0,0,10"/>
                    </StackPanel>
                </StackPanel>
            </GroupBox>

            <!-- Connection Test -->
            <GroupBox Header="Connection Test" Padding="15" Margin="0,0,0,15"
                      IsEnabled="{Binding IsRemoteMode}">
                <StackPanel>
                    <TextBlock TextWrapping="Wrap" Margin="0,0,0,10">
                        Test the connection before connecting to verify:
                        • Network connectivity
                        • Administrative share access (\\server\c$)
                        • Service control permissions
                        • ZL File Relay installation (if present)
                    </TextBlock>

                    <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                        <Button Content="Test Connection" Command="{Binding TestConnectionCommand}"
                                Width="130" Height="32" Margin="0,0,10,0"
                                IsEnabled="{Binding IsTesting, Converter={StaticResource InverseBoolConverter}}"/>
                        <Button Content="Clear Log" Command="{Binding ClearLogCommand}"
                                Width="100" Height="32"/>
                    </StackPanel>

                    <!-- Test Log -->
                    <Border BorderBrush="#CCCCCC" BorderThickness="1" Padding="10" 
                            Background="#F8F8F8" MaxHeight="200">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <ItemsControl ItemsSource="{Binding LogMessages}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding}" FontFamily="Consolas" 
                                                   FontSize="11" Margin="0,1"/>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </Border>
                </StackPanel>
            </GroupBox>

            <!-- Connect/Disconnect -->
            <GroupBox Header="Connection Status" Padding="15" Margin="0,0,0,15">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                        <TextBlock Text="{Binding StatusIcon}" FontSize="24" Margin="0,0,10,0"/>
                        <TextBlock Text="{Binding ConnectionStatus}" FontSize="16" VerticalAlignment="Center"/>
                    </StackPanel>

                    <TextBlock Text="{Binding DetectedServerInfo}" Foreground="Gray" 
                               Margin="0,0,0,15" TextWrapping="Wrap"
                               Visibility="{Binding DetectedServerInfo, Converter={StaticResource StringToVisibilityConverter}}"/>

                    <StackPanel Orientation="Horizontal">
                        <Button Content="Connect" Command="{Binding ConnectCommand}"
                                Width="100" Height="32" Margin="0,0,10,0"
                                IsEnabled="{Binding IsConnected, Converter={StaticResource InverseBoolConverter}}"/>
                        <Button Content="Disconnect" Command="{Binding DisconnectCommand}"
                                Width="100" Height="32"
                                IsEnabled="{Binding IsConnected}"/>
                    </StackPanel>
                </StackPanel>
            </GroupBox>

            <!-- Audit & Compliance -->
            <GroupBox Header="Audit &amp; Compliance" Padding="15" Margin="0,0,0,15">
                <StackPanel>
                    <CheckBox Content="Enable Audit Logging"
                              IsChecked="{Binding EnableAuditLog}"
                              FontWeight="SemiBold"
                              Margin="0,0,0,10"/>
                    <TextBlock TextWrapping="Wrap" 
                               FontSize="12" 
                               Foreground="Gray"
                               Margin="0,0,0,15">
                        Records all security-relevant events (uploads, transfers, authentication, authorization) to a separate audit log. 
                        Recommended for compliance and security monitoring.
                    </TextBlock>

                    <Grid IsEnabled="{Binding EnableAuditLog}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" 
                                   Text="Audit Log Path:" 
                                   VerticalAlignment="Center" 
                                   Margin="0,0,10,5"/>
                        <TextBox Grid.Row="0" Grid.Column="1" 
                                 Text="{Binding AuditLogPath, UpdateSourceTrigger=PropertyChanged}"
                                 Margin="0,0,5,5"
                                 ToolTip="Full path to the audit log file"/>
                        <Button Grid.Row="0" Grid.Column="2" 
                                Command="{Binding BrowseAuditLogCommand}"
                                Content="Browse..." 
                                Height="28"
                                Margin="0,0,0,5"/>
                        
                        <TextBlock Grid.Row="1" Grid.Column="0" 
                                   Text="Retention Days:" 
                                   VerticalAlignment="Center" 
                                   Margin="0,0,10,0"/>
                        <StackPanel Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="2" Orientation="Horizontal">
                            <TextBox Text="{Binding AuditLogRetentionDays, UpdateSourceTrigger=PropertyChanged}" 
                                     Width="80"
                                     Height="28"
                                     ToolTip="Number of days to retain audit logs"/>
                            <TextBlock Text=" days" 
                                       VerticalAlignment="Center" 
                                       Margin="10,0,0,0"/>
                        </StackPanel>
                    </Grid>

                    <Button Command="{Binding SaveAuditSettingsCommand}"
                            Content="Save Audit Settings"
                            Width="150"
                            Height="32"
                            HorizontalAlignment="Left"
                            Margin="0,15,0,0"/>
                </StackPanel>
            </GroupBox>

            <!-- Requirements Info -->
            <GroupBox Header="Remote Management Requirements" Padding="15">
                <StackPanel>
                    <TextBlock TextWrapping="Wrap" Margin="0,0,0,10">
                        <Bold>Required Permissions:</Bold>
                    </TextBlock>
                    <TextBlock TextWrapping="Wrap" Margin="10,0,0,5">
                        • Administrative privileges on the remote server
                    </TextBlock>
                    <TextBlock TextWrapping="Wrap" Margin="10,0,0,5">
                        • Network access to the remote server
                    </TextBlock>
                    <TextBlock TextWrapping="Wrap" Margin="10,0,0,15">
                        • Access to administrative shares (\\server\c$)
                    </TextBlock>

                    <TextBlock TextWrapping="Wrap" Margin="0,0,0,10">
                        <Bold>Firewall Requirements:</Bold>
                    </TextBlock>
                    <TextBlock TextWrapping="Wrap" Margin="10,0,0,5">
                        • SMB (TCP 445) - For file share access
                    </TextBlock>
                    <TextBlock TextWrapping="Wrap" Margin="10,0,0,15">
                        • RPC (TCP 135 + dynamic ports) - For service control
                    </TextBlock>

                    <TextBlock TextWrapping="Wrap" Margin="0,0,0,10">
                        <Bold>Supported Features (Remote Mode):</Bold>
                    </TextBlock>
                    <TextBlock TextWrapping="Wrap" Margin="10,0,0,2">
                        ✅ Configuration management
                    </TextBlock>
                    <TextBlock TextWrapping="Wrap" Margin="10,0,0,2">
                        ✅ Service control (start/stop/install/uninstall)
                    </TextBlock>
                    <TextBlock TextWrapping="Wrap" Margin="10,0,0,2">
                        ✅ Service account management
                    </TextBlock>
                    <TextBlock TextWrapping="Wrap" Margin="10,0,0,2">
                        ✅ SSH connection testing
                    </TextBlock>
                    <TextBlock TextWrapping="Wrap" Margin="10,0,0,15">
                        ✅ Web portal configuration
                    </TextBlock>

                    <TextBlock TextWrapping="Wrap" Margin="0,0,0,10">
                        <Bold>Limitations (Remote Mode):</Bold>
                    </TextBlock>
                    <TextBlock TextWrapping="Wrap" Margin="10,0,0,2" Foreground="DarkOrange">
                        ⚠️ SSH key generation must be done on the server
                    </TextBlock>
                    <TextBlock TextWrapping="Wrap" Margin="10,0,0,2" Foreground="DarkOrange">
                        ⚠️ Some permission operations may require PowerShell remoting
                    </TextBlock>
                </StackPanel>
            </GroupBox>
        </StackPanel>
    </ScrollViewer>
</UserControl>

